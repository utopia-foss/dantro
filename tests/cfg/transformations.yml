# Test cases for the TransformationsDAG
---
# Selecting items -------------------------------------------------------------
explicit_select:
  params:
    transform:
      - operation: getitem
        args:
          - !dag_tag dm
          - some/path
      - operation: getitem
        args:
          - !dag_node -1
          - foo
        tag: foo

      - operation: getitem
        args:
          - !dag_tag dm
          - some/path/bar
        tag: bar

  expected:
    num_nodes: 3
    num_objects: 4
    tags: [dm, foo, bar]
    results: &results_explicit_select
      foo:
        type: LinkContainer
        linked_path: some/path/foo
        linked_type: OrderedDataGroup
        attributes:
          name: foo
      bar:
        type: LinkContainer
        linked_path: some/path/bar
        linked_type: OrderedDataGroup
        attributes:
          name: bar


shorthand_select:
  params:
    select:
      foo: some/path/foo
      bar: some/path/bar

  expected:
    num_nodes: 2
    num_objects: 3
    tags: [dm, foo, bar]
    results:
      <<: *results_explicit_select


# Basic numerical operations --------------------------------------------------

explicit_increment:
  params:
    select:
      zero_raw: data/zeros
    transform:
      - operation: increment
        args:
          - !dag_tag zero_raw
        tag: ones

      - operation: increment
        args:
          - !dag_tag ones
        tag: twos

      - operation: decrement
        args:
          - !dag_tag ones
        tag: zeros

      - operation: .T
        args:
          - !dag_prev
        tag: zeros_T

      - operation: .T
        args:
          - !dag_tag zero_raw
        tag: zero_raw_T

  expected:
    num_nodes: 6
    num_objects: 7
    tags: [dm, zero_raw, ones, twos, zeros, zeros_T, zero_raw_T]
    results:
      zero_raw:
        type: LinkContainer
        linked_path: data/zeros
        linked_type: NumpyDataContainer
        attributes:
          name: zero_raw
          mean: 0.
          shape: [2,3,4]
      ones:
        type: NumpyDataContainer
        attributes:
          mean: 1.
          shape: [2,3,4]
      twos:
        type: NumpyDataContainer
        attributes:
          mean: 2.
          shape: [2,3,4]
      zeros:
        type: NumpyDataContainer
        attributes:
          mean: 0.
          shape: [2,3,4]
      zeros_T:
        type: NumpyDataContainer
        attributes:
          mean: 0.
          shape: [4,3,2]
      zero_raw_T:
        type: NumpyDataContainer
        attributes:
          mean: 0.
          shape: [4,3,2]
